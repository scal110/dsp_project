openapi: 3.0.1
info:
  title: Film Manager
  version: 1.0.0
  description: REST APIs that alllows to interact with the Film Manager Service

tags:
- name: api
  description: The entry point of the Film Manager Rest interface
- name: api/films 
  description: The set of all the films
- name: api/films/private
  description: The set of all the private films
- name: api/films/private/{filmId}
  description: The private film identified by filmId
- name: api/films/public
  description: The set of all public films
- name: api/films/public/{filmId}
  description: The public film identified by filmId
- name: api/films/public/{filmId}/reviews
  description: The set of all review invitations for a single public film identified by filmId
- name: api/films/public/{filmId}/reviews/{reviewerId}
  description: The review invitation for a single public film identified by filmId issued to the user identified by reviewerId
- name: api/users 
  description: The set of all the users
- name: api/users/{userId}
  description: The user idetified by userId
- name: api/users/authenticator
  description: the authenticator
- name: api/films/public/assignments
  description: The automatic assignment of review invitations to users
- name: api/films/public/invited
  description: The set of public films for which a review inviatation has been issued
- name: api/film/public/{filmId}/reviews/{reviewerId}/modifications
  description: The modifications related to a specific review
- name: api/film/public/reviews/modifications/{mId}
  description: The review modification request identified by mId
- name: api/film/public/reviews/modifications/{mId}/accept
  description: The operation to accept a review modification request
- name: api/film/public/reviews/modifications/{mId}/reject
  description: The operation to reject a review modification request
- name: api/films/public/reviews/modifications/received
  description: The set of review modification requests received
- name: api/films/public/reviews/modifications/status
  description: The set of review modification requests sent

paths:
  "/api": 
    get:
      tags:
        - api
      summary: Retrieve the Film Manager
      description: Represents the entry point of the REST interface. No authentication required.
      operationId: getFilManager
      responses:
        "200": 
          description: OK
          content:
            application/json:
              schema: 
                "$ref": "#/components/schemas/FilmManager"
        "500":
          description: Internal Server Error

  "/api/films":
    post:
      tags: 
      - "api/films"
      summary: Used to add a new film to the owner list
      description: An authenticated user can create a film that is added to it's own list
      security:
        - cookieAuth: []
      operationId: createFilm
      requestBody:
        description: Represents the film that is going to be created
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/Film"
            examples:
              example1:
                value:
                  title: Inside Out 2
                  owner: 1
                  private: true
                  watchDate: "2024-11-27"
                  rating : 9
                  favorite: false
              example2:
                value:
                  title: Inception
                  owner: 1
                  private: false
        required: true
      responses:
        "201":
          description: created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Film"
              examples:
                example1:
                  value:
                    id: 10
                    title: Inside Out 2
                    owner: 1
                    private: true
                    watchDate: "2024-11-27"
                    rating : 9
                    favorite: false
                    self: /api/films/public/10
                example2:
                  value:
                    id: 11
                    title: Inception,
                    owner: 1
                    private: false
                    reviews: /api/films/public/11/reviews
                    self: /api/films/public/11
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
    get:
      tags: 
      - "api/films"
      summary: Retrive all the films created by the authenticated user.
      description: An authenticated user can create all the films that he created.  A pagination machanism is used in order to limit the size of the messages.
      security:
        - cookieAuth: []
      operationId: getOwnedFilms
      parameters:
        - in: query
          name: pageNo                  
          required: false
          schema:
            type: integer
            default: 1
          description: The number of the requested page. It's optional so if not expessed the first page is returned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Films"
              example:
                {totalPages: 3,
                currentPage: 1,
                films: [
                    {
                      id: 10,
                      title: Inside Out 2,
                      owner: 1,
                      private: true,
                      watchDate: "2024-11-27",
                      rating : 9,
                      favorite: false,
                      self: /api/films/public/10
                    },
                    {
                        id: 11,
                        title: Inception,
                        owner: 1,
                        private: false,
                        reviews: /api/films/public/11/reviews,
                        self: /api/films/public/11
                    }
                ],
                next: /api/films?pageNo=2
                }
            


        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error

  "/api/films/private":
    get:
      tags: 
      - "api/films/private"
      security:
        - cookieAuth: []
      operationId: getPrivateFilms
      summary: retrieve the private films of the user.
      description: A logged-in user can retrieve his private films. A pagination machanism is used in order to limit the size of the messages.
      parameters:
        - in: query
          name: pageNo
          required: false
          schema:
            type: integer
            default: 1
          description: The number of the requeted page. It's optional so if not expessed the first page is returned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Films"
              example: 
                {
                  "totalPages": 1,
                  "currentPage": 1,
                  "films": [
                      {
                          "id": 1,
                          "title": "Your Name",
                          "owner": 1,
                          "private": true,
                          "watchDate": "2021-10-03",
                          "rating": 9,
                          "self": "/api/films/private/1"
                      },
                      {
                          "id": 4,
                          "title": "Weathering with You",
                          "owner": 1,
                          "private": true,
                          "self": "/api/films/private/4"
                      }
                  ],
                  "next": null
              }
              
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
  "/api/films/private/{filmId}":
    get:
      tags: 
      - "api/films/private/{filmId}"
      security:
        - cookieAuth: []
      operationId: getSinglePrivateFilm
      summary: retrieve a specific private film of the user.
      description: A logged-in user can retrieve a specific private film that he owns.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 10
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Film"
              example: 
                id: 10
                title: Inside Out 2
                owner: 1
                private: true
                watchDate: "2024-11-27"
                rating : 9
                favorite: false
                self: /api/films/public/10

        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
    put:
      tags: 
      - "api/films/private/{filmId}"
      security:
        - cookieAuth: []
      operationId: updateSinglePrivateFilm
      summary: Update a specific private film of the user.
      description: A logged-in user can update a specific private film that he owns except for it's visibility.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 10
      requestBody:
        description: The film object that must be replaced to the old one
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/Film"
            example:
              title: Inside Out 2
              owner: 1
              private: true
              watchDate: "2024-11-27"
              rating : 10
              favorite: true
        required: true
      responses:
        "200":
          description: Succesfully Updated           
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "409":
          description: Conflict (The request is not allowed, like a change of visibility)
        "500":
          description: Internal Server Error

    delete:
      tags: 
      - "api/films/private/{filmId}"
      security:
        - cookieAuth: []
      operationId: deleteSinglePrivateFilm
      summary: Delete a specific private film of the user.
      description: A logged-in user can delete a specific private film that he owns.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 10
      responses:
        "204":
          description: Successfully Deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "500":
          description: Internal Server Error

  "/api/films/public":
    get:
      tags: 
      - "api/films/public"
      operationId: getPublicFilms
      summary: retrieve a list of public films.
      description: A generic user can retrieve a list of public films added by other users. 
        A pagination machanism is used in order to limit the size of the messages.
      parameters:
        - in: query
          name: pageNo
          required: false
          schema:
            type: integer
            default: 1
          description: The number of the requested page. It's optional so if not expessed the first page is returned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Films"
              example: 
                {
                  "totalPages": 3,
                  "currentPage": 1,
                  "films": [
                      {
                          "id": 2,
                          "title": "Heaven's Feel",
                          "owner": 2,
                          "private": false,
                          "reviews": "/api/films/public/2/reviews",
                          "self": "/api/films/public/2"
                      },
                      {
                          "id": 3,
                          "title": "You Can (Not) Redo",
                          "owner": 1,
                          "private": false,
                          "reviews": "/api/films/public/3/reviews",
                          "self": "/api/films/public/3"
                      }
                  ],
                  "next": "/api/films/public?pageNo=2"
              }
        "500":
          description: Internal Server Error
  "/api/films/public/invited":
    get:
      security:
      - cookieAuth: []
      tags:
      - api/films/public/invited
      summary: Retrieve the public films that the logged-user has been invited to review
      description: The logged-in user can retrieve all the public films he was invited to review. 
        A pagination machanism is used in order to limit the size of the messages.
      operationId: getInvitedFilms
      parameters:
        - in: query
          name: pageNo
          required: false
          schema:
            type: integer
            default: 1
          description: The number of the requested page. It's optional so if not expessed the first page is returned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Films"
              example: 
                {
                  "totalPages": 2,
                  "currentPage": 1,
                  "films": [
                      {
                          "id": 3,
                          "title": "You Can (Not) Redo",
                          "owner": 1,
                          "private": false,
                          "reviews": "/api/films/public/3/reviews",
                          "self": "/api/films/public/3"
                      },
                      {
                          "id": 4,
                          "title": "Weathering with You",
                          "owner": 1,
                          "private": false,
                          "reviews": "/api/films/public/4/reviews",
                          "self": "/api/films/public/4"
                      }
                  ],
                  "next": "/api/films/public/invited?pageNo=2"
              }
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error



  "/api/films/public/{filmId}":
    get:
      tags: 
      - "api/films/public/{filmId}"
      operationId: getSinglePublicFilm
      summary: retrieve a specific public film.
      description: A generic user can retrieve a specific public film.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 11
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Film"
              example: 
                id: 11
                title: Inception
                owner: 1
                private: false
                reviews: /api/films/public/11/reviews
                self: /api/films/public/11
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
    put:
      tags: 
      - "api/films/public/{filmId}"
      security:
        - cookieAuth: []
      operationId: updateSinglePublicFilm
      summary: Update a specific public film of the user.
      description: A logged-in user can update a specific public film that he owns except for it's visibility.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 11
      requestBody:
        description: The film object that must be replaced to the old one
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/Film"
            example: 
              title: Inception Remake
              owner: 1
              private: false
        required: true
      responses:
        "200":
          description: Succesfully Updated
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "409":
          description: Conflict (The request is not allowed, like a change of visibility)
        "500":
          description: Internal Server Error

    delete:
      tags: 
      - "api/films/public/{filmId}"
      security:
        - cookieAuth: []
      operationId: deleteSinglePublicFilm
      summary: Delete a specific public film of the user.
      description: A logged-in user can delete a specific public film that he owns.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 11
      responses:
        "204":
          description: Successfully Deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
  "/api/films/public/{filmId}/reviews":
    get:
      tags: 
      - "api/films/public/{filmId}/reviews"
      operationId: getFilmReviews
      summary: retrieve the reviews of a specific public film.
      description: A generic user can retrieve all the reviews of a specific public film. 
        A pagination machanism is used in order to limit the size of the messages.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 2
        - in: query
          name: pageNo
          required: false
          schema:
            type: integer
            default: 1
          description: The number of the requested page. It's optional so if not expessed the first page is returned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Reviews"
              example: 
                {
                  "totalPages": 1,
                  "currentPage": 1,
                  "reviews": [
                      {
                          "filmId": 2,
                          "reviewerId": 2,
                          "completed": true,
                          "reviewDate": "2022-04-04",
                          "rating": 10,
                          "review": "I could not stop watching until the very end. However, you must watch the prequels before this film to really understand it.",
                          "self": "/api/films/public/2/reviews/2"
                      },
                      {
                          "filmId": 2,
                          "reviewerId": 5,
                          "completed": true,
                          "reviewDate": "2022-03-04",
                          "rating": 10,
                          "review": "This film is a perfect conclusion for the trilogy.",
                          "self": "/api/films/public/2/reviews/5"
                      }
                  ],
                  "next": null
              }
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
    post:
      tags: 
      - "api/films/public/{filmId}/reviews"
      security:
      - cookieAuth: []
      operationId: issueFilmReviews
      summary: Issue film review to some users
      description: The owner of the public film, identified by filmId, assign it to one or more users and the relative reviews are created
                   with the completed property set to false.
      parameters:
      - name: filmId
        in: path
        required: true
        schema:
          type: integer
          format: int64
          example : 10
      requestBody:
        description: An array of reviewers . Each item in the array identifies a user to whom 
          the review for a specific film (identified by the filmId parameter) should be issued.
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  reviewerId:
                    type: integer
              example: 
                [{
                    "reviewerId":5
                  },{
                    "reviewerId":4                 
                  }] 
        required: true
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                  "$ref": "#/components/schemas/Reviews"
              example: 
                [
                  {
                      "filmId": 4,
                      "reviewerId": 4,
                      "completed": false,
                      "self": "/api/films/public/4/reviews/4"
                  },
                  {
                      "filmId": 4,
                      "reviewerId": 5,
                      "completed": false,
                      "self": "/api/films/public/4/reviews/5"
                  }
              ]
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (user is not the owner)
        '404':
          description: Not Found
        '409':
          description: Conflict (e.g., wrong film id or unknown reviewer id)
        '500':
          description: Internal Server Error      
      
  "/api/films/public/{filmId}/reviews/{reviewerId}":
    get:
      tags: 
      - "api/films/public/{filmId}/reviews/{reviewerId}"
      operationId: getSingleReview
      summary: retrieve a specific review of a public film.
      description: A generic user can retrieve a specific completed review of a public film.
        An authenticated user can retrive an incomplete review if it's assigned to him 
        or if he is the owner of the film
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 2
        - name: reviewerId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 5
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Review"
              examples:
                example1:
                  value:
                    filmId: 2
                    reviewerId: 5
                    completed: true
                    reviewDate: "2022-03-04"
                    rating": 10
                    review: This film is a perfect conclusion for the trilogy.
                    self: "/api/films/public/2/reviews/5"
              
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
    put:
      tags: 
      - "api/films/public/{filmId}/reviews/{reviewerId}"
      security:
      - cookieAuth: []
      operationId: completeSingleReview
      summary: Complete a review
      description: This operation allows to set the review, identified by the pair filmId, reviewerId, as completed.
         The completed property is set to true and the reviewDate, rating and review properties are changed
         according to the values specified by the user that completed the review.
      parameters:
      - name: filmId
        in: path
        required: true
        schema:
          type: integer
          format: int64
          example: 4
      - name: reviewerId
        in: path
        required: true
        schema:
          type: integer
          format: int64
          example: 1
      requestBody:
        description: The completed review 
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/Review"
            example: 
              {
                "filmId": 4,
                "reviewerId": 1,
                "completed": true,
                "reviewDate": "2025-01-04",
                "rating": 9,
                "review": "Amazing story!",
              }

                
        required: true
            
      responses:
        "204":
          description: Succesfully completed
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "500":
          description: Internal Server Error
    delete:
      tags: 
      - "api/films/public/{filmId}/reviews/{reviewerId}"
      security:
      - cookieAuth: []
      operationId: deleteReviewInvitation
      summary: Delete a review invitation
      description: This operation can be performed only by the film's owner on a review that is not yet completed.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 6
        - name: reviewerId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 1
      responses:
        "204":
          description: Successfully Deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "409":
          description: Conflict (e.g. the review is already completed)
        "500":
          description: Internal Server Error
  "/api/films/public/assignments":
    post:
      tags:
      - api/films/public/assignments
      security:
      - cookieAuth: []
      summary: Assign automatically review invitations for the unassigned public films
        owned by the authenticated user in a balanced manner
      description: The films owned by the authenticated user who performed the request
        and that are not assigned to any user for review, are automatically assigned
        to the users of the service in a balanced manner. The assignments are returned.
        Only authenticated users can make this request.
      operationId: assignReviewBalanced
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  properties:
                    filmId:
                      type: integer
                    reviewerId:
                      type: integer
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
  
  "/api/users":
    get:
      tags: 
      - "api/users"
      security:
      - cookieAuth: []
      summary: Get informations about users
      description: An authenticated user can retrieve informations about all the other users (Password excluded)
      operationId: getUsers
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Users"
              example: 
                [
                  {
                      "id": 1,
                      "name": "User",
                      "email": "user.dsp@polito.it",
                      "self": "/api/users/1"
                  },
                  {
                      "id": 2,
                      "name": "Frank",
                      "email": "frank.stein@polito.it",
                      "self": "/api/users/2"
                  },
                  {
                      "id": 3,
                      "name": "Karen",
                      "email": "karen.makise@polito.it",
                      "self": "/api/users/3"
                  },
                  {
                      "id": 4,
                      "name": "Rene",
                      "email": "rene.regeay@polito.it",
                      "self": "/api/users/4"
                  },
                  {
                      "id": 5,
                      "name": "Beatrice",
                      "email": "beatrice.golden@polito.it",
                      "self": "/api/users/5"
                  },
                  {
                      "id": 6,
                      "name": "Arthur",
                      "email": "arthur.pendragon@polito.it",
                      "self": "/api/users/6"
                  }
                  ]
        '401':
          description: Unauthorized
        '404':
          description: Not Found
  "/api/users/{userId}":
    get:
      tags: 
      - "api/users/{userId}"
      security:
      - cookieAuth: []
      summary: Get informations about a specific user 
      description: An authenticated user can retrieve informations about a user idetified by userId (Password excluded)
      operationId: getSingleUser
      parameters:
      - name: userId
        in: path
        description: unique identifier of the user to get
        required: true
        schema:
          type: integer
          format: int64
          example: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
              example: 
                {
                    "id": 1,
                    "name": "User",
                    "email": "user.dsp@polito.it",
                    "self": "/api/users/1"
                }
        '401':
          description: Unauthorized
        '404':
          description: Not Found
  "/api/users/authenticator":
    post:
      tags:
      - "api/users/authenticator"
      summary: Logs a user in
      description: The user who wants to log in sends the user data to the
        authenticator which performs the operation. If the request for the login of a new user
        comes from an already authenticated user, the previous user is first logged out.
      operationId: authenticateUser
      requestBody:
        description: The data of the user who wants to perform log in. The data
          structure must contain email and password.
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/User"
            example: 
              {
                "email":"user.dsp@polito.it",
                "password":"password"
            }
        required: true
      responses:
        '200':
          description: Succesfully Authenticated
          headers:
            Set-Cookie:
              schema:
                type: string
                example: token=scal110; Path=/; HttpOnly
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
              example: 
                {
                    "id": 1,
                    "name": "User",
                    "email": "user.dsp@polito.it",
                    "self": "/api/users/1"
                }
        '401':
          description: Unauthorized    
  "/api/films/public/{filmId}/reviews/{reviewerId}/modifications":
    get: 
      tags:
        - api/film/public/{filmId}/reviews/{reviewerId}/modifications
      operationId: getSingleFilmReviewModificationRequests
      security:
        - cookieAuth: []
      summary: retrieve all the review modification request related to a specific review.
      description: An authenticated user can retrieve all the review modification requests
        related to a specific review if he is the owner or the reviewer, ordered for status 
        (pending ones first) and then for mId. 
        A pagination machanism is used in order to limit the size of the messages.
      parameters:
        - name: filmId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 3
        - name: reviewerId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 1
        - in: query
          name: pageNo
          required: false
          schema:
            type: integer
            default: 1
          description: The number of the requested page. It's optional so if not expessed the first page is returned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ReviewModifications"
              example: 
                {
                  "totalPages": 2,
                  "currentPage": 1,
                  "mRequests": [
                      {
                          "mId": 1,
                          "filmId": 3,
                          "reviewerId": 1,
                          "deadline": "2026-01-15T14:30:00Z",
                          "status": true,
                          "self": "/api/films/public/reviews/modifications/1",
                          "review": "/api/films/public/3/reviews/1"
                      },
                      {
                          "mId": 2,
                          "filmId": 3,
                          "reviewerId": 1,
                          "deadline": "2026-01-15T14:30:00Z",
                          "status": false,
                          "self": "/api/films/public/reviews/modifications/2",
                          "review": "/api/films/public/3/reviews/1"
                      }
                  ],
                  "next": "/api/films/public/3/reviews/1/modifications?pageNo=2"
                }
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (The user is not owner or the review is not assigned to him)
        "500":
          description: Internal Server Error
    post: 
      tags:
        - api/film/public/{filmId}/reviews/{reviewerId}/modifications
      summary: Used to create a new review modification request
      description: An authenticated user can request to the owner of the film to modify the review.
      security:
        - cookieAuth: []
      operationId: createReviewModificationRequest
      parameters:
      - name: filmId
        in: path
        required: true
        schema:
          type: integer
          format: int64
          example: 6
      - name: reviewerId
        in: path
        required: true
        schema:
          type: integer
          format: int64
          example: 1
      requestBody:
        description: Represents the review modification request that is going to be created
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/ReviewModification"
            example: 
              {
                "filmId":6,
                "reviewerId":1,
                "deadline":"2026-01-15T14:30:00Z"
            }
        required: true
      responses:
        "201":
          description: created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ReviewModification"
              example: 
                {
                  "mId": 9,
                  "filmId": 6,
                  "reviewerId": 1,
                  "deadline": "2026-01-15T14:30:00Z",
                  "self": "/api/films/public/reviews/modifications/9",
                  "review": "/api/films/public/6/reviews/1"
                }
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "409":
          description: Conflict (Invalid film or reviewerId)
        "500":
          description: Internal Server Error



  "/api/films/public/reviews/modifications/{mId}":
    get: 
      tags:
        - api/film/public/reviews/modifications/{mId}
      operationId: getSingleReviewModificationRequest
      security:
        - cookieAuth: []
      summary: retrieve a specific review modification request.
      description: An authenticated user can retrieve a specific review modification request 
        that he sent to the owner of the public film to modify the review.
      parameters:
        - name: mId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example: 1
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ReviewModification"
              examples :
                example1:
                  description: Accepted review modification request
                  value:
                    {
                      "mId": 1,
                      "filmId": 3,
                      "reviewerId": 1,
                      "deadline": "2026-01-15T14:30:00Z",
                      "status": true,
                      "self": "/api/films/public/reviews/modifications/1",
                      "review": "/api/films/public/3/reviews/1"
                  }
                example2:
                  description: The owner of the film retrieves a pending request of a reviewer.
                  value:
                    {
                      "mId": 7,
                      "filmId": 3,
                      "reviewerId": 2,
                      "deadline": "2026-01-15T14:30:00Z",
                      "status": null,
                      "self": "/api/films/public/reviews/modifications/7",
                      "review": "/api/films/public/3/reviews/2",
                      "accept": "/api/films/public/reviews/modifications/7/accept",
                      "reject": "/api/films/public/reviews/modifications/7/reject"
                    }
                example3:
                  description: The owner of the film retrieves a pending request that he made to himself
                  value:
                    {
                      "mId": 5,
                      "filmId": 3,
                      "reviewerId": 1,
                      "deadline": "2026-01-15T14:30:00Z",
                      "status": null,
                      "self": "/api/films/public/reviews/modifications/5",
                      "review": "/api/films/public/3/reviews/1",
                      "accept": "/api/films/public/reviews/modifications/5/accept",
                      "reject": "/api/films/public/reviews/modifications/5/reject",
                      "delete": "/api/films/public/reviews/modifications/5"
                  }
                example4:
                  description: The reviewer of the film retrieves a pending request.
                  value:
                    {
                        "mId": 9,
                        "filmId": 6,
                        "reviewerId": 1,
                        "deadline": "2026-01-15T14:30:00Z",
                        "status": null,
                        "self": "/api/films/public/reviews/modifications/9",
                        "review": "/api/films/public/6/reviews/1",
                        "delete": "/api/films/public/reviews/modifications/9"
                    }
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "500":
          description: Internal Server Error

    delete:
      tags:
        - api/film/public/reviews/modifications/{mId}
      security:
        - cookieAuth: []
      operationId: deleteSingleReviewModificationRequest
      summary: Delete a specific review modification request.
      description: A logged-in user can delete a specific review modification request 
        that he sent to the film owner while it is in a pending state.
      parameters:
        - name: mId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            example : 9
      responses:
        "204":
          description: Successfully Deleted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "409":
          description: Conflict (The modification request is not in a pending status)
        "500":
          description: Internal Server Error

  "/api/films/public/reviews/modifications/{mId}/accept":
    put: 
      tags:
        - api/film/public/reviews/modifications/{mId}/accept
      summary: Used to accept a review modification request
      description: The owner of the film can accept a pending review modification request
      security:
        - cookieAuth: []
      operationId: acceptReviewModificationRequest
      parameters:
      - name: mId
        in: path
        required: true
        schema:
          type: integer
          format: int64
          example: 3
      responses:
        "204":
          description: Succesfully accepted
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "409":
          description: Conflict (The modification request is not pending)
        "500":
          description: Internal Server Error    
  "/api/films/public/reviews/modifications/{mId}/reject":
    put: 
      tags:
        - api/film/public/reviews/modifications/{mId}/reject
      summary: Used to reject review modification request
      description: The owner of the film can reject a pending review modification request or the deadline is exceded
      security:
        - cookieAuth: []
      operationId: rejectReviewModificationRequest
      parameters:
      - name: mId
        in: path
        required: true
        schema:
          type: integer
          format: int64
          example: 7
      responses:
        "204":
          description: Succesfully rejected
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "409":
          description: Conflict (Invalid film or reviewerId)
        "500":
          description: Internal Server Error
  "/api/films/public/reviews/modifications/status" :
    get: 
      tags:
        - api/films/public/reviews/modifications/status
      operationId: getReviewModificationRequestsStatus
      security:
        - cookieAuth: []
      summary: retrieve the status of all the review modification requests sent.
      description: An authenticated user can retrieve the status 
        of all the review modification request that he sent. 
        A pagination machanism is used in order to limit the size of the messages.
      parameters:      
        - in: query
          name: pageNo
          required: false
          schema:
            type: integer
            default: 1
          description: The number of the requested page. It's optional so if not expessed the first page is returned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ReviewModifications"
              example: 
                {
                  "totalPages": 1,
                  "currentPage": 1,
                  "mRequests": [
                      {
                          "mId": 7,
                          "filmId": 3,
                          "reviewerId": 2,
                          "deadline": "2026-01-15T14:30:00Z",
                          "status": null,
                          "self": "/api/films/public/reviews/modifications/7",
                          "review": "/api/films/public/3/reviews/2",
                          "delete": "/api/films/public/reviews/modifications/7"
                      },
                      {
                          "mId": 8,
                          "filmId": 3,
                          "reviewerId": 2,
                          "deadline": "2025-01-16T14:30:00Z",
                          "status": true,
                          "self": "/api/films/public/reviews/modifications/8",
                          "review": "/api/films/public/3/reviews/2"
                      }
                  ],
                  "next": null
              }

        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error
  "/api/films/public/reviews/modifications/received" :
    get: 
      tags:
        - api/films/public/reviews/modifications/received
      operationId: getReviewModificationRequestsReceived
      security:
        - cookieAuth: []
      summary: retrieve all the review modification requests received.
      description: An authenticated user can retrieve 
        all the review modification requests for the public films owned by him.
        A pagination machanism is used in order to limit the size of the messages.
      parameters:      
        - in: query
          name: pageNo
          required: false
          schema:
            type: integer
            default: 1
          description: The number of the requested page. It's optional so if not expessed the first page is returned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/ReviewModifications"
              example: 
                {
                  "totalPages": 4,
                  "currentPage": 1,
                  "mRequests": [
                      {
                          "mId": 5,
                          "filmId": 3,
                          "reviewerId": 1,
                          "deadline": "2026-01-15T14:30:00Z",
                          "status": null,
                          "self": "/api/films/public/reviews/modifications/5",
                          "review": "/api/films/public/3/reviews/1",
                          "accept": "/api/films/public/reviews/modifications/5/accept",
                          "reject": "/api/films/public/reviews/modifications/5/reject",
                          "delete": "/api/films/public/reviews/modifications/5"
                      },
                      {
                          "mId": 7,
                          "filmId": 3,
                          "reviewerId": 2,
                          "deadline": "2026-01-15T14:30:00Z",
                          "status": null,
                          "self": "/api/films/public/reviews/modifications/7",
                          "review": "/api/films/public/3/reviews/2",
                          "accept": "/api/films/public/reviews/modifications/7/accept",
                          "reject": "/api/films/public/reviews/modifications/7/reject"
                      }
                  ],
                  "next": "/api/films/public/reviews/modifications/received?pageNo=2"
              }
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error




components:
  schemas:
    FilmManager:
      description: schema for FilmManager data structure (api entry point)
      type: object
      additionalProperties: false
      properties:
        films:
          type: string
          description: URI to access the api/films endpoint
          format: uri
        privateFilms:
          type: string
          description: URI to access the api/films/private endpoint
          format: uri
        publicFilms:
          type: string
          description: URI to access the api/films/public endpoint
          format: uri
        invitedPublicFilms:
          type: string
          format: uri
          description: URI to access the api/films/public/invited endpoint
        reviewAssignments:
          type: string
          description: URI to access the api/films/public/assignments endpoint
          format: uri
        users:
          type: string
          description: URI to access the api/users endpoint
          format: uri
        usersAuthenticator:
          type: string
          description: URI to access the api/users/authenticator endpoint
          format: uri
    User:
      description: schema for User data structure
      type: object
      additionalProperties: false
      properties:
        "$schema":
          type: string
          description: path to the JSON schema used to validate the user data structure
        id:
          type: integer
          description: The unique identifier of the user
        name:
          type: string
          description: the username of the user
        email:
          type: string
          format: email
          description: the user's email.
        password:
          type: string
          minLength: 6
          maxLength: 20
          description: the user's password.
        self:
          type: string
          format: uri
          description:  URI to access user-specific details.

      required:
        - email
        - password
    Users:
      type: array
      items:
        "$ref": "#/components/schemas/User"
      description: Array of User objects representing the list of users.
    Film:
      type: object
      description: The schema for the film data structure
      additionalProperties: false
      properties:
        "$schema":
          type: string
          description: The path to the schema that describes the film data structure
        id:
          type: integer
          description: The film's unique identifier
        title:
          type: string
          description: The film's title
        owner:
          type: integer
          description: The id of the user that created the film data structure
        private:
          type: boolean
          default: true
          description: It's true if the owner is the only one that can access the film, false otherwise
        watchDate:
          type: string
          format: date
          description: The date when the owner watched the Film
        rating:
          type: integer
          minimum: 0
          maximum: 10
          description: the rating that the owner has given to the film
        favourite:
          type: boolean
          default: false
          description: It's true if the film is among the owner favourites, false otherwise
        reviews:
          type: string
          format: uri
          description: the reviews that other users have given to the film
        self:
          type: string
          format: uri
          description: URI to access the specific film resource.
      required:
        - title
        - owner
        - private
    Films:
      type: object
      additionalProperties: false
      description: the schema for the films data structure
      properties:
        "$schema":
          type: string
          description: The path to the schema used to validate the films data structure
        totalPages:
          type: integer
          minimum: 1
          description: the total number of pages
        currentPage:
          type: integer
          minimum: 1
          description: the number of the currentPage
        films:
          type: array
          items:
            "$ref": "#/components/schemas/Film"
          description: the list of films on the current page
        next:
          type: string
          format: uri
          description: URI for accessing the next page
      required:
        - totalPages
    Review:
      type: object
      description: The schema for the review data structure
      additionalProperties: false
      properties:
        "$schema":
          type: string
          description: the path to the scham used to validate the review data structure
        filmId:
          type: integer
          description: unique identifier of the film for which a review invitation has been issued
        reviewerId:
          type: integer
          description: the unique identifier of the user who has received the review invitation
        completed:
          type: boolean
          default: false
          description: It's true if the review has benn completed, false otherwise
        reviewDate:
          type: string
          format: date
          description: the date when the review has been completed by the invited user
        rating:
          type: integer
          minimum: 0
          maximum: 10
          description: the rating of the review the user has completed
        review:
          type: string
          maxLength: 1000
          description: a textual description of the review
        film: 
          type: string
          format: uri
          description: URI to access the film related to the review
        delete: 
          type: string
          format: uri
          description: URI to delete the modification request(if not completed).
        self:
          type: string
          format: uri
          description: URI to access the specific review resource
      required:
        - filmId
        - reviewerId
    Reviews:
      type: object
      description: The schema for the reviews data structure
      additionalProperties: false
      properties:
        "$schema":
          type: string
          description: path to the schema used to validate the reviews data structure
        totalPages:
          type: integer
          minimum: 1
          description: the total number of pages
        currentPage:
          type: integer
          minimum: 1
          description: the number of the currentPage
        reviews:
          type: array
          items:
            "$ref": "#/components/schemas/Review"
          description: the reviews of the current page
        next:
          type: string
          format: uri
          description: URI for accessing the next page
      required:
        - totalPages
    ReviewModification:
      type: object
      description: The schema for the review modification request data structure
      additionalProperties: false
      properties:
        "$schema":
          type: string
          description: path to the JSON Schema to use for the validation of the data structure
        mId:
          type: integer
          description: Unique identifier of the review modification request
        filmId:
          type: integer
          description: unique identifier of the film which the review modification request is related 
        reviewerId:
          type: integer
          description: the unique identifier of the user who sent the review modfication request
        deadline:
          type: string
          format: date-time
          description: The deadline by wich an answer is expected
        status:
          type: boolean
          nullable: true
          default: null
          description: Its true if the request is accepted, false if if the request is refused or null if the request is pending
        review:
          type: string
          format: uri
          description: URI to access the review associated with the request.
        accept:
          type: string
          format: uri
          description: URI to accept the modification request.
        reject:
          type: string
          format: uri
          description: URI to reject the modification request.
        delete: 
          type: string
          format: uri
          description: URI to delete the modification request(if in a pending status).
        self:
          type: string
          format: uri
          description: URI to access the specific review modification request.
      required:
        - filmId
        - reviewerId
        - deadline
    ReviewModifications:
      type: object
      description: The schema for the reviewModifications data structure
      additionalProperties: false
      properties:
        "$schema":
          type: string
          description: path to the schema used to validate the reviews data structure
        totalPages:
          type: integer
          minimum: 1
          description: the total number of pages
        currentPage:
          type: integer
          minimum: 1
          description: the number of the currentPage
        reviews:
          type: array
          items:
            "$ref": "#/components/schemas/ReviewModification"
          description: the reviews modification requests of the current page
        next:
          type: string
          format: uri
          description: the path to the next page
      required:
        - totalPages


  securitySchemes:
    cookieAuth:
      description: JWT to identify the authenticated user.
      type: apiKey
      in: cookie
      name: connect.sid
